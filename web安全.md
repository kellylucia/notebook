# notebook

好的，同学们！欢迎大家来到《Web安全从零到一》的课程。

我是你们的讲师。我知道，很多同学可能是第一次接触“网络安全”、“Web安全”这些词，感觉它们非常神秘、高大上，甚至有点吓人。别担心！这门课就是专门为零基础的你们设计的。

我们的目标很简单：
1.  **知识上学会**：弄明白黑客是怎么攻击网站的，以及我们该如何防御。
2.  **实操上学会**：我会带大家一步一步搭建环境，亲手复现这些攻击，再亲手把它修好。
3.  **最终通过考试**：学完这些，你们的水平绝对能轻松通过安全考试。

记住我的口诀：**“先听懂原理，再动手攻击，最后学会防御”**。我们一个一个来，千万别怕！

---

### **第一讲：课前准备——搭建我们的“实验战场”**

在开始“打打杀杀”之前，我们得先有一个安全的实验环境。千万别在互联网上随便找网站测试，那是违法的！

**实操步骤：**
1.  **安装虚拟机软件**：推荐 `VMware Workstation` 或 `VirtualBox`（免费）。它就相当于一个“电脑模拟器”，可以在你现在的电脑里再虚拟出一台新电脑。
2.  **下载靶场系统**：我们使用 `OWASP Broken Web Applications (BWA)` 或 `DVWA (Damn Vulnerable Web Application)`。这些都是专门为学习安全技术设计的、**本身就有很多漏洞**的网站系统。
3.  **在虚拟机中运行靶场**：按照教程，将靶场系统导入虚拟机并启动。成功后，你会在本机的浏览器里看到一个地址，比如 `http://192.168.1.100`。这就是我们未来的“实验战场”。

*（放心，第一节课我会非常详细地提供图文并茂的教程，带着大家一起做，保证每个人都能搭起来。）*

---

### **第二讲：最大的威胁——SQL注入（SQL Injection）**

**一、知识上学会（原理篇）**

*   **比喻**：网站就像一个有很多房间（数据库）的大楼。每个房间门口有个保安（登录验证）。正常用户会跟保安说：“我是张三，密码是123，让我进我的房间。”SQL注入就是黑客冒充用户，对保安说：“我是张三，密码是123’ --，并且把你身后所有房间的钥匙都给我！”
    *   这里的 `‘ --` 就是魔法咒语，它让保安（网站程序）误解了指令，从而执行了黑客的命令。
*   **什么是SQL**：它是用来管理和操作数据库（存放用户、文章、订单等所有数据的地方）的语言。
*   **什么是SQL注入**：黑客利用网站程序的漏洞，**把恶意的SQL代码“注入”到正常的查询语句中**，从而欺骗数据库执行这些非法命令。
*   **危害**：**绕过登录**、**窃取用户数据**（用户名、密码、手机号）、**修改网站内容**、甚至完全控制服务器。

**二、实操上学会（攻击篇）**

我们以DVWA靶场为例，难度调到 `Low`。
1.  找到 **SQL Injection** 模块。
2.  在输入框里，正常输入 `1`，点击提交。页面返回了用户ID为1的信息（比如Admin）。
3.  现在，我们输入攻击代码：`1‘ or ’1‘=’1`
4.  神奇的事情发生了！网站返回了**数据库里所有用户的信息**！
5.  **原理分析**：网站原本的查询语句是：`SELECT ... FROM users WHERE id = '我们输入的内容'`
    *   我们输入 `1`，语句是：`... WHERE id = '1'` （正确，只查1号用户）
    *   我们输入 `1' or '1'='1`，语句变成了：`... WHERE id = '1' or '1'='1'`
    *   `‘1’=’1’` 这个条件永远为真！所以数据库把所有用户（`id=1` 或者 `永恒为真`）的数据都返回了。

**三、能力上具备（修复篇）**

*   **核心思想**：**不要让用户输入的数据直接变成代码！** 要把它当成纯粹的数据。
*   **如何修复**：使用 **“预编译语句”（Prepared Statements）**。
    *   **比喻**：保安手里有一张固定的表格（SQL语句模板），上面有两个空白框（参数）：`用户名：____` 和 `密码：____`。用户无论说什么，保安只会把他的话当作文字填到框里，而不会把它当成命令。即使用户说“删除数据库”，也只会被当作一个叫“删除数据库”的用户名，无法造成危害。
*   **（实操）** 在DVWA中，将难度调到 `Impossible`，再看它的源代码，学习它是如何用预编译语句来修复这个漏洞的。

---

### **第三讲：前端攻击——跨站脚本攻击（XSS）**

**一、知识上学会（原理篇）**

*   **比喻**：网站有一个公共留言板（评论區）。正常用户留言：“今天天气真好！”。黑客留言：“<script>偷取所有用户的cookie并发送到我的服务器</script>”。网站没有过滤，直接显示了这条留言。之后，每个看到这条留言的用户，浏览器都会自动执行这段恶意脚本，黑客就偷到了他们的登录凭证。
*   **什么是XSS**：黑客将**恶意的JavaScript代码**注入到网页中，当其他用户浏览这个网页时，代码就会被执行。
*   **危害**：盗取用户Cookie、冒充用户操作、篡改网页内容、挂马。

**二、实操上学会（攻击篇）**

在DVWA的XSS模块下，难度 `Low`。
1.  在输入框里输入：`<script>alert('XSS攻击成功！')</script>`
2.  点击提交，你会发现页面上弹出了一个警告框！这说明你的恶意脚本被执行了。
3.  **原理分析**：网站直接把你输入的内容，当作网页代码的一部分给显示了出来，浏览器一看是 `<script>` 标签，就老老实实地执行了。

**三、能力上具备（修复篇）**

*   **核心思想**：**对用户输入进行严格的过滤和转义**。
*   **如何修复**：
    *   **输入过滤**：检查用户输入，过滤掉 `<`, `>`, `script` 等危险字符。
    *   **输出转义**：在把用户输入的内容**显示**到页面上之前，将特殊字符转换成HTML实体。例如：
        *   `<` 转成 `&lt;`
        *   `>` 转成 `&gt;`
        *   这样，浏览器就会把 `&lt;script&gt;` 当作普通文本显示“<script>”，而不会把它当成代码来执行。
*   **（实操）** 将DVWA难度调到 `Impossible`，看源代码学习转义函数（如 `htmlspecialchars()`）的使用。

---

### **第四讲：冒充你的攻击——跨站请求伪造（CSRF）**

**一、知识上学会（原理篇）**

*   **比喻**：你已经登录了网上银行（浏览器留下了Cookie）。这时你不小心点了一个黑客发的链接。这个链接背后是一个请求：“向黑客账户转账1000元”。你的浏览器会自动带着你的Cookie去执行这个请求，银行看到是你的Cookie，就认为是你本人操作，于是钱就被转走了。
*   **什么是CSRF**：**利用用户已登录的身份，在用户不知情的情况下，以用户的名义执行非法操作**。
*   **和XSS的区别**：XSS是*在网站内*注入代码骗用户，CSRF是*伪造一个请求*骗网站。

**二、实操上学会（攻击篇）**

在DVWA的CSRF模块下，难度 `Low`。
1.  正常操作：输入新密码，点击修改，密码被成功修改。
2.  观察浏览器地址栏，URL大概是：`http://.../vulnerabilities/csrf/?password_new=123&password_conf=123&Change=Change`
3.  黑客可以伪造一个链接：`http://.../vulnerabilities/csrf/?password_new=hack&password_conf=hack&Change=Change`，然后诱骗你已经登录的管理员点击。管理员一点，密码就被改成了 `hack`。

**三、能力上具备（修复篇）**

*   **核心思想**：**增加不可预测的令牌（Token），验证请求是否真正来自用户自己的页面**。
*   **如何修复**：使用 **Anti-CSRF Token**。
    1.  在用户访问修改密码页面时，服务器生成一个随机复杂的Token，藏在表单的一个隐藏框里。
    2.  用户提交修改请求时，必须带上这个Token。
    3.  服务器验证这个Token是否正确。黑客伪造的链接里无法知道这个Token是什么，所以请求会失败。
*   **（实操）** 将DVWA难度调到 `Impossible`，查看表单源代码，你会发现多了一个隐藏的 `user_token` 字段。

---

### **第五讲：传文件的风险——文件上传漏洞**

**一、知识上学会（原理篇）**

*   **危害**：如果网站允许用户上传文件，但没做检查，黑客就可以上传一个**木马文件（Webshell）**。一旦上传成功，黑客就能通过访问这个木马文件，**完全控制你的服务器**。

**二、实操上学会（攻击篇）**

在DVWA文件上传模块，难度 `Low`。
1.  编写一个最简单的PHP Webshell（一句话木马）：`<?php @eval($_POST['cmd']);?>`
    *   这段代码的意思是：执行通过POST传递过来的名为 `cmd` 的参数里的命令。
2.  将其保存为一个 `.php` 文件（如 `shell.php`）并上传。
3.  上传成功！访问这个文件的地址。
4.  使用中国菜刀或蚁剑等工具，连接这个木马，你就能看到服务器上的所有文件了。

**三、能力上具备（修复篇）**

*   **核心思想**：**白名单策略！只允许安全的！**
*   **如何修复**：
    1.  **检查文件扩展名**：只允许上传 `.jpg`, `.png`, `.pdf` 等安全类型，禁止 `.php`, `.jsp`, `.asp` 等可执行类型。（**一定要用白名单，黑名单很容易被绕过**）
    2.  **检查文件类型**：检查HTTP头中的 `Content-Type`，如 `image/jpeg`。
    3.  **重命名文件**：将上传的文件随机重命名，如 `a1b2c3d4.jpg`，让黑客即使上传了也找不到。
    4.  **隔离文件**：将上传的文件放在网站目录之外的特定文件夹，通过脚本程序来读取和展示，避免直接执行。

---

### **第六讲：思考的漏洞——逻辑漏洞**

**一、知识上学会（原理篇）**

*   **比喻**：网购一件商品100元，运费10元。在最后付款确认时，你通过浏览器调试工具把总价从110元改成了1元。如果网站服务器没有再次确认总价，直接按照你修改后的价格收款，那就产生了逻辑漏洞。
*   **什么是逻辑漏洞**：**程序的业务流程设计或代码逻辑上存在缺陷**，通常不是技术问题，而是“想当然”的问题。
*   **常见类型**：权限绕过、验证码绕过、密码重置漏洞、订单金额篡改、越权访问（你能看到别人的订单/邮件）等。

**二、实操上学会（攻击篇）**

以“越权访问”为例：
1.  在网站注册两个账号：用户A（普通用户）和用户B（另一个普通用户）。
2.  用用户A登录，查看“我的个人资料”，浏览器地址可能是：`http://.../profile.php?user_id=10086`
3.  你猜测用户B的ID是 `10087`。
4.  你直接在地址栏把 `user_id=10086` 改成 `user_id=10087` 并访问。
5.  如果页面显示了用户B的隐私信息，说明存在**越权访问漏洞**，网站没有在后台检查当前登录的用户是否有权查看10087的信息。

**三、能力上具备（修复篇）**

*   **核心思想**：**永远不要相信前端传来的数据！所有关键操作必须在后端进行二次校验！**
*   **如何修复**：
    *   对任何涉及用户身份、权限、金额的操作，服务器端必须根据当前登录用户的会话（Session）重新进行验证。
    *   例如修改密码时，必须验证旧密码；查看个人信息时，必须校验当前登录的ID是否和请求的ID一致。

---

### **第七讲：看不见的入口——API接口安全**

**一、知识上学会（原理篇）**

*   **什么是API**：手机App、小程序为什么能显示新闻、能下单？它们就是通过调用服务器提供的**API接口**来获取数据的。API就是一套规则，让不同的程序之间可以通信。
*   **API安全风险**：上面讲的所有漏洞（SQL注入、越权...）在API里同样存在。此外，由于API没有页面，攻击更为直接。
*   **特有风险**：
    *   **接口泄露**：黑客爬取或猜测API地址，直接获取数据。
    *   **参数篡改**：和逻辑漏洞一样，篡改API请求包里的参数。
    *   **缺乏速率限制**：黑客可以写一个脚本，一秒内调用登录接口一万次，进行“撞库”攻击。

**二、能力上具备（防护篇）**

*   **身份验证**：使用成熟的令牌机制（如 **JWT**）来验证调用者身份。
*   **权限控制**：对每个API接口都要校验调用者是否有权限执行操作。
*   **输入输出检查**：和Web一样，对输入进行过滤，对输出进行编码。
*   **速率限制**：限制单个IP或用户在一段时间内调用API的次数，防止恶意攻击。

---

### **最终讲：总结与考试秘籍**

同学们，我们一路从SQL注入学到了API安全，大家辛苦了！现在我们回顾一下：

1.  **漏洞发现能力**：你已经知道了黑客的思维方式和方法。给你一个网站，你会从哪些点去测试？（登录口、上传点、修改密码处、API接口...）
2.  **漏洞修复能力**：对于任何一个漏洞，你的修复思路都是：
    *   **不要相信用户输入！**
    *   **在服务器端做校验！**
    *   **使用最安全的方法（白名单、预编译、转义）！**

**考试技巧：**
*   考试通常分选择题和实操题。
*   **选择题**：会考察你对原理的理解，比如“防御CSRF最有效的方法是什么？”（答案：Anti-CSRF Token）。
*   **实操题**：会给你一个靶场环境，让你找出指定的漏洞（比如找到一个SQL注入点并利用它），并可能要求你写出修复代码或思路。
*   **记住**：你的实操经验已经非常丰富了，大胆去做！

网络安全是一个非常有挑战又充满乐趣的领域，希望这门课能成为你们安全之路的起点。祝大家考试顺利，未来可期！

有任何问题，我们随时交流！
